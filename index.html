<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Predictor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
    <style>
        :root {
            --color-primary: #2563eb;
            --color-primary-dark: #1e40af;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-info: #06b6d4;
            --color-bg: #f8fafc;
            --color-surface: #ffffff;
            --color-text: #1e293b;
            --color-text-light: #64748b;
            --color-border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--color-bg);
            min-height: 100vh;
            padding: 20px;
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            border-radius: 16px;
            color: white;
            box-shadow: 0 10px 40px rgba(37, 99, 235, 0.3);
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: clamp(1rem, 3vw, 1.2rem);
            opacity: 0.95;
        }

        .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        /* Disclaimer */
        .disclaimer {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left: 4px solid var(--color-danger);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .disclaimer strong {
            color: var(--color-danger);
            display: block;
            margin-bottom: 8px;
        }

        /* Cards */
        .card {
            background: var(--color-surface);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 24px;
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--color-primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Controls */
        .controls-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--color-bg);
        }

        select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .btn {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid var(--color-border);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Sentiment Section */
        .sentiment-overview {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            border-left: 4px solid var(--color-info);
        }

        .sentiment-score {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 16px;
        }

        .sentiment-emoji {
            font-size: 4rem;
        }

        .sentiment-details h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .sentiment-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .sentiment-fill {
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .sentiment-fill.positive {
            background: linear-gradient(90deg, var(--color-success), #22c55e);
        }

        .sentiment-fill.negative {
            background: linear-gradient(90deg, var(--color-danger), #f87171);
        }

        .sentiment-fill.neutral {
            background: linear-gradient(90deg, var(--color-warning), #fbbf24);
        }

        /* News Section */
        .news-grid {
            display: grid;
            gap: 16px;
            margin-top: 20px;
        }

        .news-item {
            background: white;
            padding: 16px;
            border-radius: 10px;
            border-left: 4px solid var(--color-primary);
            transition: all 0.3s;
        }

        .news-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateX(4px);
        }

        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .news-title {
            font-weight: 600;
            font-size: 0.95rem;
            flex: 1;
            color: var(--color-text);
        }

        .news-sentiment-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 12px;
            white-space: nowrap;
        }

        .news-sentiment-badge.positive {
            background: #d1fae5;
            color: #065f46;
        }

        .news-sentiment-badge.negative {
            background: #fee2e2;
            color: #991b1b;
        }

        .news-sentiment-badge.neutral {
            background: #fef3c7;
            color: #92400e;
        }

        .news-meta {
            font-size: 0.8rem;
            color: var(--color-text-light);
            margin-top: 8px;
        }

        .news-events {
            margin-top: 8px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .event-tag {
            padding: 4px 10px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Predictions */
        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .pred-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid var(--color-warning);
        }

        .pred-card.bullish {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left-color: var(--color-success);
        }

        .pred-card.bearish {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left-color: var(--color-danger);
        }

        .pred-card h3 {
            font-size: 0.9rem;
            color: var(--color-text-light);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pred-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .pred-card .change {
            font-size: 0.95rem;
            margin-top: 6px;
            font-weight: 600;
        }

        .pred-card .reason {
            font-size: 0.8rem;
            margin-top: 8px;
            color: var(--color-text-light);
            font-style: italic;
        }

        /* Chart */
        .chart-container {
            background: var(--color-surface);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 24px;
        }

        #priceChart {
            max-height: 450px;
        }

        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .metric-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid var(--color-primary);
        }

        .metric-box h3 {
            font-size: 0.85rem;
            color: var(--color-text-light);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .metric-box .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-primary-dark);
        }

        /* Status */
        .status {
            padding: 12px 16px;
            border-radius: 10px;
            margin-top: 16px;
            display: none;
        }

        .status.success {
            background: #d1fae5;
            border: 1px solid var(--color-success);
            color: #065f46;
            display: block;
        }

        .status.error {
            background: #fee2e2;
            border: 1px solid var(--color-danger);
            color: #991b1b;
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }

            .predictions-grid {
                grid-template-columns: 1fr;
            }

            .sentiment-score {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>Stock Price Predictor</h1>
            <p class="subtitle">Powered by Sentiment Analysis & Machine Learning</p>
            <span class="badge">üî¥ LIVE ‚Ä¢ Real Data + News Sentiment</span>
        </header>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <strong>‚ö†Ô∏è IMPORTANT LEGAL DISCLAIMER</strong>
            This tool is for EDUCATIONAL PURPOSES ONLY. It is NOT financial advice. 
            Stock markets are unpredictable. Always consult licensed financial advisors 
            before making investment decisions. Past performance does not guarantee future results.
        </div>

        <!-- Controls -->
        <div class="controls-grid">
            <div class="card">
                <h2>Select Stock</h2>
                <div class="form-group">
                    <label for="stockSymbol">Stock (NSE)</label>
                    <select id="stockSymbol">
                        <option value="RELIANCE.NS">Reliance Industries</option>
                        <option value="TCS.NS">Tata Consultancy Services</option>
                        <option value="HDFCBANK.NS">HDFC Bank</option>
                        <option value="INFY.NS">Infosys</option>
                        <option value="SBIN.NS">State Bank of India</option>
                        <option value="BHARTIARTL.NS">Bharti Airtel</option>
                        <option value="ITC.NS">ITC Limited</option>
                        <option value="ICICIBANK.NS">ICICI Bank</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="predictionDays">Prediction Period</label>
                    <select id="predictionDays">
                        <option value="7">7 Days</option>
                        <option value="14">14 Days</option>
                        <option value="30" selected>30 Days</option>
                    </select>
                </div>

                <button class="btn" onclick="runPrediction()" id="predictBtn">
                    Generate AI Predictions
                </button>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Analyzing news & market data...</p>
                </div>

                <div class="status" id="statusMessage"></div>
            </div>

            <div class="card">
                <h2>Current Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric-box">
                        <h3>Price</h3>
                        <div class="value">‚Çπ<span id="currentPrice">--</span></div>
                    </div>
                    <div class="metric-box">
                        <h3>RSI</h3>
                        <div class="value"><span id="rsiValue">--</span></div>
                    </div>
                    <div class="metric-box">
                        <h3>Trend</h3>
                        <div class="value" id="trendIndicator">--</div>
                    </div>
                    <div class="metric-box">
                        <h3>Sentiment</h3>
                        <div class="value" id="sentimentQuick">--</div>
                    </div>
                    <div class="metric-box">
                        <h3>Volatility</h3>
                        <div class="value" id="volatilityMetric">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sentiment Analysis Section -->
        <div class="card" id="sentimentSection" style="display: none;">
            <h2>üß† News Sentiment Analysis</h2>
            
            <div class="sentiment-overview">
                <div class="sentiment-score">
                    <div class="sentiment-emoji" id="sentimentEmoji">üòê</div>
                    <div class="sentiment-details" style="flex: 1;">
                        <h3 id="sentimentTitle">Analyzing market sentiment...</h3>
                        <p id="sentimentDescription">Based on <span id="newsCount">0</span> recent news articles</p>
                        <div class="sentiment-bar">
                            <div class="sentiment-fill neutral" id="sentimentBar" style="width: 50%;">
                                <span id="sentimentScore">Neutral</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="news-grid" id="newsContainer">
                <!-- News items populated by JavaScript -->
            </div>
        </div>

        <!-- Predictions -->
        <div class="card" id="predictionsSection" style="display: none;">
            <h2>AI-Powered Predictions</h2>
            <div class="predictions-grid" id="predictionsContainer">
                <!-- Predictions populated by JavaScript -->
            </div>
        </div>

        <!-- Chart -->
        <div class="chart-container" id="chartSection" style="display: none;">
            <h2>Price History & Forecast with Sentiment</h2>
            <canvas id="priceChart"></canvas>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CONFIGURATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const API_URL = 'https://stock-price-predictor-qxj5.onrender.com/api';
        let chart = null;
        let currentStockData = null;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // API FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function fetchStockData(symbol) {
            const response = await fetch(`${API_URL}/stock/${symbol}`);
            if (!response.ok) {
                throw new Error(`Failed to fetch data: ${response.statusText}`);
            }
            return await response.json();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PREDICTION MODEL
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function generateSentimentBasedPredictions(historicalData, days, sentiment) {
            const closes = historicalData.map(d => d.close);
            const lastPrice = closes[closes.length - 1];
            const lastDate = new Date(historicalData[historicalData.length - 1].date);
            
            // Calculate base trend
            const recentPrices = closes.slice(-30);
            const trend = (recentPrices[recentPrices.length - 1] - recentPrices[0]) / recentPrices[0];
            
            // Calculate volatility
            const returns = [];
            for (let i = 1; i < recentPrices.length; i++) {
                returns.push((recentPrices[i] - recentPrices[i-1]) / recentPrices[i-1]);
            }
            const avgReturn = returns.reduce((a,b) => a+b, 0) / returns.length;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / (returns.length - 1);
            const volatility = Math.sqrt(variance);
            
            // Sentiment impact on predictions
            const sentimentImpact = sentiment.overallSentiment || 0;
            const sentimentBoost = sentimentImpact * 0.10; // Up to ¬±10% impact
            
            // Generate predictions
            const predictions = [];
            let currentPrice = lastPrice;
            
            for (let i = 0; i < days; i++) {
                // Base trend with decay
                const trendComponent = trend * Math.exp(-i * 0.02);
                
                // Sentiment influence (stronger near-term, weaker long-term)
                const sentimentComponent = sentimentBoost * Math.exp(-i * 0.05);
                
                // Mean reversion
                const meanPrice = recentPrices.reduce((a,b) => a+b, 0) / recentPrices.length;
                const meanReversionForce = (meanPrice - currentPrice) / meanPrice * 0.03;
                
                // Controlled randomness (reduced from pure random)
                const randomComponent = (Math.random() - 0.5) * volatility * 0.5;
                
                // Combine all factors
                const totalChange = trendComponent + sentimentComponent + meanReversionForce + randomComponent;
                currentPrice = currentPrice * (1 + totalChange);
                
                // Next trading day
                const nextDate = new Date(lastDate);
                nextDate.setDate(nextDate.getDate() + i + 1);
                while (nextDate.getDay() === 0 || nextDate.getDay() === 6) {
                    nextDate.setDate(nextDate.getDate() + 1);
                }
                
                // Determine reason for change
                let reason = '';
                if (Math.abs(sentimentComponent) > Math.abs(trendComponent)) {
                    reason = sentimentComponent > 0 ? 'Driven by positive news sentiment' : 'Affected by negative news';
                } else if (Math.abs(trendComponent) > 0.01) {
                    reason = trendComponent > 0 ? 'Following upward trend' : 'Continuing downward trend';
                } else {
                    reason = 'Market consolidation expected';
                }
                
                predictions.push({
                    date: nextDate.toISOString().split('T')[0],
                    price: parseFloat(currentPrice.toFixed(2)),
                    confidence: Math.max(0.5, 1 - (i / days) * 0.5),
                    reason: reason
                });
            }
            
            return predictions;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI UPDATE FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function updateSentimentDisplay(sentiment) {
            if (!sentiment || sentiment.newsCount === 0) {
                document.getElementById('sentimentSection').style.display = 'none';
                return;
            }

            document.getElementById('sentimentSection').style.display = 'block';

            // Update emoji
            const emoji = sentiment.sentimentLabel === 'positive' ? 'üòä' :
                         sentiment.sentimentLabel === 'negative' ? 'üòü' : 'üòê';
            document.getElementById('sentimentEmoji').textContent = emoji;

            // Update title and description
            const sentimentText = sentiment.sentimentLabel === 'positive' ? 'Positive Market Sentiment' :
                                 sentiment.sentimentLabel === 'negative' ? 'Negative Market Sentiment' :
                                 'Neutral Market Sentiment';
            document.getElementById('sentimentTitle').textContent = sentimentText;
            document.getElementById('newsCount').textContent = sentiment.newsCount;

            // Update sentiment bar
            const score = ((sentiment.overallSentiment + 1) / 2) * 100; // Convert -1 to 1 ‚Üí 0% to 100%
            const sentimentBar = document.getElementById('sentimentBar');
            sentimentBar.style.width = score + '%';
            sentimentBar.className = 'sentiment-fill ' + sentiment.sentimentLabel;
            
            const scoreText = sentiment.overallSentiment > 0 ? 
                `+${(sentiment.overallSentiment * 100).toFixed(1)}%` :
                `${(sentiment.overallSentiment * 100).toFixed(1)}%`;
            document.getElementById('sentimentScore').textContent = scoreText;

            // Update quick sentiment
            document.getElementById('sentimentQuick').textContent = emoji;

            // Display news items
            const newsContainer = document.getElementById('newsContainer');
            newsContainer.innerHTML = '';

            if (sentiment.recentNews && sentiment.recentNews.length > 0) {
                sentiment.recentNews.forEach(news => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'news-item';
                    
                    const badgeClass = news.sentiment.label;
                    const badgeText = news.sentiment.label.charAt(0).toUpperCase() + news.sentiment.label.slice(1);
                    
                    let eventsHTML = '';
                    if (news.events && news.events.length > 0) {
                        eventsHTML = '<div class="news-events">';
                        news.events.forEach(event => {
                            eventsHTML += `<span class="event-tag">${event.category.replace('_', ' ')}</span>`;
                        });
                        eventsHTML += '</div>';
                    }
                    
                    const publishedDate = new Date(news.publishedAt).toLocaleDateString();
                    
                    newsItem.innerHTML = `
                        <div class="news-header">
                            <div class="news-title">${news.title}</div>
                            <span class="news-sentiment-badge ${badgeClass}">${badgeText}</span>
                        </div>
                        ${eventsHTML}
                        <div class="news-meta">${news.source} ‚Ä¢ ${publishedDate}</div>
                    `;
                    
                    newsContainer.appendChild(newsItem);
                });
            } else {
                newsContainer.innerHTML = '<p style="color: var(--color-text-light); text-align: center; padding: 20px;">No recent news available</p>';
            }
        }

        function updatePredictions(predictions, currentPrice, sentiment) {
            document.getElementById('predictionsSection').style.display = 'block';
            
            const container = document.getElementById('predictionsContainer');
            const tomorrow = predictions[0];
            const week = predictions[6] || predictions[predictions.length - 1];
            const month = predictions[predictions.length - 1];
            
            const prices = predictions.map(p => p.price);
            const high = Math.max(...prices);
            const low = Math.min(...prices);
            
            const tomorrowChange = ((tomorrow.price - currentPrice) / currentPrice * 100).toFixed(2);
            const weekChange = ((week.price - currentPrice) / currentPrice * 100).toFixed(2);
            const monthChange = ((month.price - currentPrice) / currentPrice * 100).toFixed(2);
            
            container.innerHTML = `
                <div class="pred-card ${tomorrowChange > 0 ? 'bullish' : 'bearish'}">
                    <h3>Tomorrow</h3>
                    <div class="value">‚Çπ${tomorrow.price.toFixed(2)}</div>
                    <div class="change">${tomorrowChange > 0 ? '+' : ''}${tomorrowChange}%</div>
                    <div class="reason">${tomorrow.reason}</div>
                </div>
                <div class="pred-card ${weekChange > 0 ? 'bullish' : 'bearish'}">
                    <h3>7 Days</h3>
                    <div class="value">‚Çπ${week.price.toFixed(2)}</div>
                    <div class="change">${weekChange > 0 ? '+' : ''}${weekChange}%</div>
                    <div class="reason">${week.reason}</div>
                </div>
                <div class="pred-card ${monthChange > 0 ? 'bullish' : 'bearish'}">
                    <h3>30 Days</h3>
                    <div class="value">‚Çπ${month.price.toFixed(2)}</div>
                    <div class="change">${monthChange > 0 ? '+' : ''}${monthChange}%</div>
                    <div class="reason">${month.reason}</div>
                </div>
                <div class="pred-card">
                    <h3>Predicted High</h3>
                    <div class="value">‚Çπ${high.toFixed(2)}</div>
                    <div class="change">+${((high - currentPrice) / currentPrice * 100).toFixed(2)}%</div>
                    <div class="reason">Peak forecast</div>
                </div>
                <div class="pred-card">
                    <h3>Predicted Low</h3>
                    <div class="value">‚Çπ${low.toFixed(2)}</div>
                    <div class="change">${((low - currentPrice) / currentPrice * 100).toFixed(2)}%</div>
                    <div class="reason">Bottom forecast</div>
                </div>
            `;
        }

        function updateChart(historical, predictions) {
            document.getElementById('chartSection').style.display = 'block';
            
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            const historicalDates = historical.map(d => d.date);
            const predictionDates = predictions.map(p => p.date);
            const allDates = [...historicalDates, ...predictionDates];
            
            const historicalPrices = [...historical.map(d => d.close), ...Array(predictions.length).fill(null)];
            const predictionPrices = [...Array(historical.length).fill(null), ...predictions.map(p => p.price)];
            
            if (chart) {
                chart.data.labels = allDates;
                chart.data.datasets[0].data = historicalPrices;
                chart.data.datasets[1].data = predictionPrices;
                chart.update('none');
            } else {
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: allDates,
                        datasets: [
                            {
                                label: 'Historical Price',
                                data: historicalPrices,
                                borderColor: '#2563eb',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0,
                                pointHoverRadius: 5,
                                borderWidth: 2
                            },
                            {
                                label: 'Sentiment-Based Prediction',
                                data: predictionPrices,
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderDash: [5, 5],
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0,
                                pointHoverRadius: 5,
                                borderWidth: 3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    font: { size: 13, weight: '600' },
                                    usePointStyle: true,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                callbacks: {
                                    title: function(context) {
                                        return context[0].label;
                                    },
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) label += ': ';
                                        if (context.parsed.y !== null) {
                                            label += '‚Çπ' + context.parsed.y.toFixed(2);
                                        }
                                        return label;
                                    },
                                    afterLabel: function(context) {
                                        if (context.dataset.label === 'Sentiment-Based Prediction') {
                                            const index = context.dataIndex - historical.length;
                                            if (index >= 0 && predictions[index]) {
                                                return predictions[index].reason;
                                            }
                                        }
                                        return '';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45,
                                    autoSkip: true,
                                    maxTicksLimit: 15
                                }
                            },
                            y: {
                                beginAtZero: false,
                                grid: { color: 'rgba(0, 0, 0, 0.05)' },
                                ticks: {
                                    callback: function(value) {
                                        return '‚Çπ' + value.toFixed(0);
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function updateMetrics(data, indicators) {
            document.getElementById('currentPrice').textContent = indicators.currentPrice.toFixed(2);
            document.getElementById('rsiValue').textContent = indicators.rsi.toFixed(1);
    
            // Show Bullish/Bearish/Neutral text
            const trendText = indicators.trend === 'bullish' ? 'üìà Bullish' : 'üìâ Bearish';
            document.getElementById('trendIndicator').textContent = trendText;
    
            // Calculate and show volatility
            const closes = data.data.map(d => d.close).slice(-30);
            const returns = [];
            for (let i = 1; i < closes.length; i++) {
                returns.push((closes[i] - closes[i-1]) / closes[i-1]);
            }
            const avgReturn = returns.reduce((a,b) => a+b, 0) / returns.length;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / (returns.length - 1);
            const annualizedVol = (Math.sqrt(variance) * Math.sqrt(252) * 100).toFixed(2);
    
            document.getElementById('volatilityMetric').textContent = annualizedVol + '%';
        }

        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MAIN PREDICTION FUNCTION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function runPrediction() {
            const symbol = document.getElementById('stockSymbol').value;
            const days = parseInt(document.getElementById('predictionDays').value);
            const btn = document.getElementById('predictBtn');
            const loading = document.getElementById('loading');
            
            try {
                btn.disabled = true;
                loading.classList.add('active');
                document.getElementById('statusMessage').style.display = 'none';
                
                // Fetch data
                const data = await fetchStockData(symbol);
                currentStockData = data;
                
                // Update metrics
                updateMetrics(data, data.indicators);
                
                // Update sentiment display
                updateSentimentDisplay(data.sentiment);
                
                // Generate predictions with sentiment
                const predictions = generateSentimentBasedPredictions(
                    data.data, 
                    days, 
                    data.sentiment
                );
                
                // Update displays
                updatePredictions(predictions, data.indicators.currentPrice, data.sentiment);
                updateChart(data.data, predictions);
                
                showStatus(`‚úì Generated ${days}-day forecast with sentiment analysis`, 'success');
                
            } catch (error) {
                console.error('Prediction error:', error);
                showStatus(`‚úó Error: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                loading.classList.remove('active');
            }
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            console.log('Stock Predictor with Sentiment Analysis initialized');
        });
    </script>
</body>
</html>
